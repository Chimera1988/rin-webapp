/* ===== Базовые переменные темы ===== */
:root {
  --bg: #0f1115;
  --bg-2: #141821;
  --bg-3: #1b2130;
  --text: #e9eef7;
  --muted: #9aa6bf;
  --bubble-me: #2675ff;
  --bubble-her: #2a2f3a;
  --bubble-time: #9aa6bf;
  --sep: #232a3a;
}

.theme-light {
  --bg: #f5f6f8;
  --bg-2: #ffffff;
  --bg-3: #f1f3f6;
  --text: #0b1020;
  --muted: #56617a;
  --bubble-me: #2a88ff;
  --bubble-her: #e9ecf3;
  --bubble-time: #6b7691;
  --sep: #dde2ee;
}

/* ===== Сбросы / базис ===== */
* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font: 16px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, system-ui, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
img { display:block; max-width:100%; height:auto; }

/* ===== Шапка под iOS notch ===== */
.tg-header {
  position: sticky; top: 0; z-index: 20;
  display:flex; align-items:center; gap:12px;
  padding: calc(env(safe-area-inset-top) + 8px) 12px 8px 12px;
  background: var(--bg-2);
  border-bottom: 1px solid var(--sep);
}

.tg-ico {
  width:36px; height:36px; border-radius:10px;
  background: transparent; color: var(--text);
  border: 1px solid var(--sep);
  display:grid; place-items:center;
}
.tg-ico svg { color: currentColor; }

.tg-peer { display:flex; align-items:center; gap:10px; min-width:0; }
.tg-peer .peer-meta { min-width:0; }
.peer-name { font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.peer-status { color:var(--muted); font-size:12px; }

/* ===== Аватары ===== */
.avatar {
  width:40px; height:40px; border-radius:50%;
  object-fit:cover;
  border:none; outline:none; box-shadow:none; /* убираем любые «ореолы» */
  background: transparent;
}
.avatar.small { width:28px; height:28px; }
.avatar.small.spacer { visibility:hidden; }

/* ===== Основная область ===== */
.app { height: calc(100dvh - 64px - env(safe-area-inset-bottom)); display:flex; flex-direction:column; }
.chat {
  flex:1 1 auto; overflow:auto;
  padding:12px;
  background:
    linear-gradient(var(--bg), var(--bg)) /* базовый фон */,
    var(--rin-wallpaper, none);
  background-size: cover;
  background-attachment: fixed;
  background-position: center;
}

/* ===== Сообщения ===== */
.row { display:flex; align-items:flex-end; gap:8px; margin:8px 0; }
.row.her { flex-direction:row; }
.row.me  { flex-direction:row-reverse; }

.bubble {
  max-width: 82%;
  padding: 10px 12px;
  border-radius: 14px;
  position: relative;
  word-wrap: break-word;
  line-height: 1.45;
}
.bubble.her { background: var(--bubble-her); color: var(--text); }
.bubble.me  { background: var(--bubble-me); color: #fff; }

.bubble-time {
  display:inline-block;
  margin-left:10px;
  font-size:12px;
  color: var(--bubble-time);
  opacity:.9;
}

/* три точки «печатает…» */
.typing { display:flex; gap:4px; align-items:center; }
.typing span {
  width:6px; height:6px; border-radius:50%;
  background: var(--muted); opacity:.4;
  animation: dot 1s infinite ease-in-out;
}
.typing span:nth-child(2){ animation-delay:.2s; }
.typing span:nth-child(3){ animation-delay:.4s; }
@keyframes dot { 0%,80%,100%{transform:scale(.8)} 40%{transform:scale(1)} }

/* ===== Стикеры ===== */
.bubble.sticker-only {
  background: transparent; padding: 0; box-shadow: none;
}
.bubble.sticker-only .sticker {
  width: 72vw; max-width: 420px; height: auto;
  border-radius: 14px;
  background: transparent; border: none; outline: none; box-shadow: none; /* никаких ореолов */
  display:block;
}
@media (min-width: 600px) {
  .bubble.sticker-only .sticker { width: 360px; }
}

/* ===== Компонент ввода ===== */
.composer {
  display:flex; gap:10px; padding:10px 12px;
  background: var(--bg-2);
  border-top:1px solid var(--sep);
  position: sticky; bottom:0; z-index: 15;
  padding-bottom: calc(10px + env(safe-area-inset-bottom));
}
.composer input {
  flex:1 1 auto; height:44px;
  padding:0 12px; border-radius:12px;
  border:1px solid var(--sep);
  background: var(--bg-3); color: var(--text);
}
.composer button {
  width:44px; height:44px; border-radius:12px;
  background: var(--bubble-me); color:#fff; border:none;
}

/* ===== Панель настроек (нижний лист) ===== */
.settings.hidden { display:none; }
.settings__backdrop {
  position:fixed; inset:0; background: rgba(0,0,0,.45);
}
.settings__sheet {
  position:fixed; left:0; right:0; bottom:0;
  background: var(--bg-2);
  border-top-left-radius: 16px; border-top-right-radius:16px;
  border-top: 1px solid var(--sep);
  padding-bottom: calc(12px + env(safe-area-inset-bottom));
  max-height: 80vh; overflow:auto;
}
.settings__head {
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 16px; border-bottom:1px solid var(--sep);
}
.settings__title { font-weight:700; }
.settings__close { background:transparent; border:none; color:var(--text); font-size:18px; }

.settings__row {
  display:grid; grid-template-columns: 1fr 2fr; gap:12px;
  padding:12px 16px; border-bottom:1px solid var(--sep);
}
.settings__label { color: var(--muted); }
.settings__actions .btn,
.btn {
  height:36px; padding:0 10px;
  border:1px solid var(--sep); border-radius:10px;
  background: var(--bg-3); color: var(--text);
}

.btn-danger { background:#db3d3d; border-color:#db3d3d; color:#fff; }

/* ===== Аудио‑кнопка в пузыре ===== */
.audio-ctl {
  margin-top:6px;
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px; border-radius:10px;
  background: var(--bg-3); color: var(--text);
  border:1px solid var(--sep);
  font-size:14px;
}
.audio-ctl button {
  width:30px; height:30px; border-radius:8px;
  display:grid; place-items:center;
  background: var(--bubble-me); color:#fff; border:none;
}
